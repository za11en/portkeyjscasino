<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portkey | Regulated Ontario iGaming Data</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gold: { 400: '#C5A059', 500: '#B08D55', 600: '#8A6D3B' }, // Muted Luxury Gold
                        void: '#0A0A0A',
                        surface: '#141414',
                        surfaceLight: '#1F1F1F',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Montserrat', 'sans-serif'],
                    },
                    boxShadow: {
                        'glow': '0 0 20px rgba(176, 141, 85, 0.15)',
                    }
                }
            }
        }
    </script>
    <style>
        [v-cloak] { display: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .text-gradient { background: linear-gradient(to right, #C5A059, #E6D2A9); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .btn-shimmer { background: linear-gradient(90deg, #B08D55 0%, #E6D2A9 50%, #B08D55 100%); background-size: 200%; animation: shimmer 3s infinite linear; color: #000; }
        @keyframes shimmer { 0% { background-position: 100% 0; } 100% { background-position: -100% 0; } }
        .logo-fallback { display: flex; align-items: center; justify-content: center; background: #222; color: #666; font-weight: bold; }
    </style>
</head>
<body class="bg-void text-gray-200 font-sans antialiased selection:bg-gold-500 selection:text-black flex flex-col min-h-screen">

    <div id="app" v-cloak class="flex-grow">

        <div v-if="error" class="fixed inset-0 z-50 bg-black/95 flex items-center justify-center p-8 text-center">
            <div class="border border-red-900/50 p-8 rounded-lg bg-surface max-w-lg">
                <h1 class="text-3xl font-display font-bold text-white mb-2">Location Restricted</h1>
                <p class="text-gray-400 text-sm">Portkey.ca is authorized for use only within Ontario, Canada.</p>
                <div class="mt-4 inline-block px-3 py-1 bg-red-900/20 text-red-500 text-xs rounded border border-red-900/30">Detected: {{ errorRegion }}</div>
            </div>
        </div>

        <div v-if="!ageVerified && !error" class="fixed inset-0 z-50 bg-black/98 flex items-center justify-center p-4">
            <div class="bg-surface border border-white/10 rounded-xl p-8 max-w-md w-full text-center shadow-2xl">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e2/19%2B_Age_Restriction_Logo.svg/1024px-19%2B_Age_Restriction_Logo.svg.png" class="h-12 mx-auto mb-6 opacity-80 filter invert">
                <h1 class="text-2xl font-display font-bold text-white mb-3">Regulatory Age Check</h1>
                <p class="text-gray-500 text-sm mb-8 leading-relaxed">You must be 19 years of age or older to access information regarding Ontario's regulated iGaming market.</p>
                <div class="grid grid-cols-2 gap-4">
                    <button @click="denyAge" class="py-3 rounded-lg border border-white/10 text-gray-400 hover:text-white transition text-sm">Exit Site</button>
                    <button @click="confirmAge" class="py-3 rounded-lg btn-shimmer font-bold text-sm shadow-glow">I am 19+</button>
                </div>
            </div>
        </div>

        <header class="px-6 py-4 flex justify-between items-center bg-void/90 backdrop-blur border-b border-white/5 sticky top-0 z-40">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded bg-gold-500 flex items-center justify-center text-black font-bold font-display">P</div>
                <div>
                    <span class="block text-lg font-display font-bold text-white leading-none">PORTKEY</span>
                    <span class="text-[10px] text-gray-500 uppercase tracking-widest">Authorized Data</span>
                </div>
            </div>
            <div class="hidden sm:flex items-center gap-2">
                <div class="h-2 w-2 rounded-full bg-green-500 animate-pulse"></div>
                <span class="text-xs text-green-500 font-mono">AGCO LICENSED DATA</span>
            </div>
        </header>

        <div class="pt-12 pb-8 px-4 text-center border-b border-white/5 bg-gradient-to-b from-surface to-void">
            <h1 class="text-3xl md:text-5xl font-display font-bold text-white mb-4">
                Ontario's Regulated <br/> <span class="text-gradient">iGaming Directory</span>
            </h1>
            <p class="text-gray-400 max-w-xl mx-auto text-sm mb-8">
                Live performance data for the top 40 licensed operators. <br class="hidden sm:block"> Verified bonuses, payout speeds, and RTP compliance stats.
            </p>

            <div class="flex flex-wrap justify-center gap-2 max-w-3xl mx-auto">
                <button v-for="type in ['all', 'match', 'spins', 'no_wager', 'lossback']" 
                        @click="filter = type"
                        :class="filter === type ? 'bg-gold-500 text-black border-gold-500' : 'bg-surfaceLight border-white/5 text-gray-400 hover:text-white'"
                        class="px-5 py-2 rounded-full border text-xs font-bold uppercase tracking-wide transition-all">
                    {{ type.replace('_', ' ') }}
                </button>
            </div>
        </div>

        <main class="max-w-4xl mx-auto px-4 py-12 min-h-[60vh]">
            
            <div v-if="loading" class="flex flex-col items-center justify-center py-20">
                <div class="w-10 h-10 border-2 border-gold-500 border-t-transparent rounded-full animate-spin mb-4"></div>
                <p class="text-xs text-gold-500 font-mono tracking-widest">AUTHENTICATING...</p>
            </div>

            <div class="grid grid-cols-1 gap-4">
                <div v-for="(casino, index) in filteredCasinos" :key="casino.id" 
                     class="group relative bg-surface border border-white/5 rounded-xl p-5 hover:border-gold-500/30 transition-all duration-300 flex flex-col md:flex-row items-center gap-6">
                    
                    <div v-if="casino.hero_badge" class="absolute top-0 left-0 bg-white/5 border-r border-b border-white/5 text-[9px] font-bold px-3 py-1 rounded-br-lg uppercase text-gray-400">
                        {{ casino.hero_badge }}
                    </div>

                    <div class="flex-shrink-0 relative">
                        <div class="absolute -top-1 -right-1 bg-green-500 text-black rounded-full p-0.5 z-10 border border-void" title="AGCO Licensed">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                        </div>
                        
                        <div class="w-20 h-20 rounded-lg bg-white p-2 flex items-center justify-center overflow-hidden">
                            <img :src="'https://logo.clearbit.com/' + casino.domain" 
                                 @error="e => e.target.style.display = 'none'"
                                 class="max-w-full max-h-full object-contain"
                                 alt="Logo">
                            <div class="hidden w-full h-full bg-gray-200 text-gray-400 font-bold flex items-center justify-center logo-fallback">
                                {{ casino.name.substring(0,2).toUpperCase() }}
                            </div>
                        </div>
                    </div>

                    <div class="flex-grow text-center md:text-left w-full">
                        <h2 class="text-xl font-display font-bold text-white mb-1 flex items-center justify-center md:justify-start gap-2">
                            {{ casino.name }}
                            <span class="text-[10px] text-gray-600 border border-gray-800 px-1 rounded font-mono font-normal">ON-REG</span>
                        </h2>
                        
                        <div class="bg-surfaceLight border border-white/5 rounded p-2 mb-2 inline-block w-full md:w-auto">
                             <p class="text-[10px] text-gold-500 uppercase font-bold mb-0.5">Welcome Offer</p>
                             <p class="text-sm font-bold text-white">{{ casino.sign_up_bonus }}</p>
                        </div>
                    </div>

                    <div class="flex gap-4 border-t md:border-t-0 md:border-l border-white/5 pt-4 md:pt-0 md:pl-6 min-w-[140px] justify-center">
                        <div class="text-center">
                            <p class="text-[9px] text-gray-500 uppercase font-bold">Payout</p>
                            <p class="text-lg font-bold text-white font-mono">{{ casino.metrics.speed }}h</p>
                        </div>
                        <div class="text-center">
                            <p class="text-[9px] text-gray-500 uppercase font-bold">RTP</p>
                            <p class="text-lg font-bold text-gold-500 font-mono">{{ casino.metrics.rtp }}%</p>
                        </div>
                    </div>

                    <div class="w-full md:w-auto flex-shrink-0">
                        <a :href="'/go/' + casino.id" target="_blank" class="block w-full px-6 py-3 rounded-lg bg-white text-black font-bold text-xs uppercase tracking-wider hover:bg-gold-400 transition text-center">
                            View Site
                        </a>
                        <p class="text-[8px] text-gray-600 mt-2 text-center">T&Cs Apply | 19+</p>
                    </div>

                </div>
            </div>
        </main>

        <footer class="border-t border-white/10 bg-surface py-12 mt-auto">
            <div class="max-w-4xl mx-auto px-6">
                
                <div class="flex flex-wrap justify-center items-center gap-8 mb-8 opacity-60 hover:opacity-100 transition duration-500">
                    <a href="https://igamingontario.ca" target="_blank" class="group">
                        <div class="h-10 flex items-center gap-2">
                            <img src="https://www.igamingontario.ca/themes/custom/igo_theme/images/igo-logo.svg" class="h-8 filter invert" alt="iGaming Ontario">
                        </div>
                    </a>
                    
                    <a href="https://agco.ca" target="_blank">
                         <div class="h-10 flex items-center gap-2">
                            <img src="https://www.agco.ca/themes/custom/agco_theme/logo.svg" class="h-8 filter invert" alt="AGCO">
                        </div>
                    </a>

                    <a href="https://connexontario.ca" target="_blank" class="flex items-center gap-2">
                         <span class="text-sm font-bold text-white border-l border-gray-600 pl-4">ConnexOntario</span>
                         <span class="text-xs text-gray-400 block">1-866-531-2600</span>
                    </a>
                </div>

                <div class="text-center border-t border-white/5 pt-8">
                    <p class="text-[10px] text-gray-500 leading-relaxed max-w-2xl mx-auto">
                        **LEGAL DISCLAIMER:** Portkey.ca is an independent affiliate data aggregator. We are not a gambling operator. All casinos listed are licensed by the Alcohol and Gaming Commission of Ontario (AGCO) and operate under agreement with iGaming Ontario. 
                        Gambling involves risk. Please gamble responsibly. If you or someone you know has a gambling problem, contact ConnexOntario at 1-866-531-2600 or visit <a href="https://connexontario.ca" class="text-gold-500 underline">connexontario.ca</a>. 
                        Must be 19+ and physically located in Ontario to play.
                    </p>
                    <p class="text-[10px] text-gray-600 mt-4">&copy; 2025 Portkey Analytics. All rights reserved.</p>
                </div>
            </div>
        </footer>

    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    casinos: [],
                    filter: 'all',
                    ageVerified: false,
                    loading: true,
                    error: false,
                    errorRegion: ''
                }
            },
            async mounted() {
                if(localStorage.getItem('portkey_age_verified') === 'true') this.ageVerified = true;
                
                try {
                    const urlParams = new URLSearchParams(window.location.search);
                    const devMode = urlParams.get('dev');
                    const apiUrl = devMode ? `/api/casinos?dev=true` : `/api/casinos`;

                    const res = await fetch(apiUrl);
                    if (res.status === 403) {
                        const data = await res.json();
                        this.error = true;
                        this.errorRegion = data.region || 'Unknown';
                    } else {
                        this.casinos = await res.json();
                    }
                } catch (e) {
                    console.error("Fetch error", e);
                } finally {
                    this.loading = false;
                }
            },
            computed: {
                filteredCasinos() {
                    if (this.filter === 'all') return this.casinos;
                    return this.casinos.filter(c => c.bonus_type === this.filter);
                }
            },
            methods: {
                confirmAge() { this.ageVerified = true; localStorage.setItem('portkey_age_verified', 'true'); },
                denyAge() { window.location.href = "https://www.google.ca"; }
            }
        }).mount('#app');
    </script>
</body>
</html>
